// Learning Path Schema Extension for SkillNexus LMS
// Add these models to the main schema.prisma file

model LearningPath {
  id             String   @id @default(cuid())
  title          String
  description    String?
  careerId       String?
  difficulty     String   @default("BEGINNER") // BEGINNER, INTERMEDIATE, ADVANCED, EXPERT
  estimatedHours Int      @default(0)
  isPublic       Boolean  @default(true)
  isActive       Boolean  @default(true)
  tags           String?  // JSON array of tags
  imageUrl       String?
  createdBy      String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Relations
  career      Career?                    @relation(fields: [careerId], references: [id])
  creator     User?                      @relation("CreatedPaths", fields: [createdBy], references: [id])
  steps       LearningPathStep[]
  enrollments LearningPathEnrollment[]
  reviews     PathReview[]

  @@map("learning_paths")
}

model LearningPathStep {
  id             String   @id @default(cuid())
  pathId         String
  order          Int
  title          String
  description    String?
  type           String   // COURSE, SKILL_ASSESSMENT, PROJECT, QUIZ, READING, VIDEO
  targetId       String?  // courseId, skillId, etc.
  targetType     String?  // course, skill, external_link, etc.
  isRequired     Boolean  @default(true)
  estimatedHours Int      @default(0)
  points         Int      @default(0) // Gamification points
  
  // Prerequisites (JSON array of step IDs)
  prerequisites  String?  @default("[]")
  
  // Metadata
  metadata       String?  // JSON for additional data
  
  // Relations
  path           LearningPath     @relation(fields: [pathId], references: [id], onDelete: Cascade)
  completions    StepCompletion[]

  @@map("learning_path_steps")
}

model LearningPathEnrollment {
  id            String    @id @default(cuid())
  userId        String
  pathId        String
  startedAt     DateTime  @default(now())
  completedAt   DateTime?
  lastAccessAt  DateTime  @default(now())
  progress      Float     @default(0) // 0-100
  currentStepId String?
  
  // Learning preferences
  learningStyle String?   // visual, auditory, kinesthetic, reading
  timeGoal      Int?      // hours per week
  
  // Relations
  user          User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  path          LearningPath @relation(fields: [pathId], references: [id], onDelete: Cascade)

  @@unique([userId, pathId])
  @@map("learning_path_enrollments")
}

model StepCompletion {
  id          String   @id @default(cuid())
  userId      String
  stepId      String
  completedAt DateTime @default(now())
  score       Float?   // For assessments (0-100)
  timeSpent   Int?     // In minutes
  attempts    Int      @default(1)
  
  // Feedback
  difficulty  Int?     // 1-5 rating
  feedback    String?
  
  // Relations
  user        User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  step        LearningPathStep @relation(fields: [stepId], references: [id], onDelete: Cascade)

  @@unique([userId, stepId])
  @@map("step_completions")
}

model PathReview {
  id        String   @id @default(cuid())
  userId    String
  pathId    String
  rating    Int      // 1-5 stars
  comment   String?
  createdAt DateTime @default(now())
  
  // Relations
  user      User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  path      LearningPath @relation(fields: [pathId], references: [id], onDelete: Cascade)

  @@unique([userId, pathId])
  @@map("path_reviews")
}

model SkillPrerequisite {
  id              String @id @default(cuid())
  skillId         String
  prerequisiteId  String
  requiredLevel   Int    @default(1) // 1-5 proficiency level
  weight          Float  @default(1.0) // Importance weight
  
  // Relations
  skill           Skill  @relation("SkillPrerequisites", fields: [skillId], references: [id], onDelete: Cascade)
  prerequisite    Skill  @relation("PrerequisiteFor", fields: [prerequisiteId], references: [id], onDelete: Cascade)

  @@unique([skillId, prerequisiteId])
  @@map("skill_prerequisites")
}

model LearningGoal {
  id          String   @id @default(cuid())
  userId      String
  title       String
  description String?
  targetDate  DateTime?
  priority    String   @default("MEDIUM") // LOW, MEDIUM, HIGH, URGENT
  status      String   @default("ACTIVE") // ACTIVE, COMPLETED, PAUSED, CANCELLED
  progress    Float    @default(0) // 0-100
  
  // Associated paths/skills
  pathIds     String?  // JSON array of learning path IDs
  skillIds    String?  // JSON array of skill IDs
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("learning_goals")
}

model LearningStreak {
  id            String   @id @default(cuid())
  userId        String
  currentStreak Int      @default(0)
  longestStreak Int      @default(0)
  lastActivity  DateTime @default(now())
  
  // Relations
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId])
  @@map("learning_streaks")
}

// Update existing models with new relations
// Add these to the User model:
// createdPaths      LearningPath[]           @relation("CreatedPaths")
// pathEnrollments   LearningPathEnrollment[]
// stepCompletions   StepCompletion[]
// pathReviews       PathReview[]
// learningGoals     LearningGoal[]
// learningStreak    LearningStreak?

// Add these to the Skill model:
// prerequisites     SkillPrerequisite[]      @relation("SkillPrerequisites")
// prerequisiteFor   SkillPrerequisite[]      @relation("PrerequisiteFor")

// Add this to the Career model:
// learningPaths     LearningPath[]