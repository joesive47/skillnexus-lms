// Advanced Features Schema Extension

model Note {
  id        String   @id @default(cuid())
  userId    String
  lessonId  String
  content   String
  timestamp Int?     // Video timestamp in seconds
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  lesson    Lesson   @relation(fields: [lessonId], references: [id], onDelete: Cascade)
  
  @@index([userId, lessonId])
}

model Bookmark {
  id        String   @id @default(cuid())
  userId    String
  lessonId  String
  title     String?
  createdAt DateTime @default(now())
  
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  lesson    Lesson   @relation(fields: [lessonId], references: [id], onDelete: Cascade)
  
  @@unique([userId, lessonId])
}

model StudySession {
  id        String   @id @default(cuid())
  userId    String
  courseId  String
  startTime DateTime @default(now())
  endTime   DateTime?
  duration  Int?     // in seconds
  completed Boolean  @default(false)
  
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  course    Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  
  @@index([userId, startTime])
}

model Flashcard {
  id        String   @id @default(cuid())
  userId    String
  lessonId  String
  question  String
  answer    String
  difficulty Int     @default(1) // 1-5
  nextReview DateTime
  reviewCount Int    @default(0)
  createdAt DateTime @default(now())
  
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  lesson    Lesson   @relation(fields: [lessonId], references: [id], onDelete: Cascade)
  
  @@index([userId, nextReview])
}

// Extend User model
model User {
  // ... existing fields ...
  
  // Advanced features
  notes         Note[]
  bookmarks     Bookmark[]
  studySessions StudySession[]
  flashcards    Flashcard[]
}

// Extend Lesson model  
model Lesson {
  // ... existing fields ...
  
  notes      Note[]
  bookmarks  Bookmark[]
  flashcards Flashcard[]
}